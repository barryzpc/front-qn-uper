!function(){var t="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",o=["jpg","jpeg","gif","png","bmp"],n=function(e){e=e||16;for(var o="",n=t.length,r=null,i=0;e>i;i++)r=Math.floor(Math.random()*n),o+=t.substring(r-1,r);return o},r=function(){var t={};return t=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),t.timeout=this.timeout,t},i=function(t,e){var o=this,n=r();n.open(t.method,t.url,!0),n.onload=function(){if(200===n.status){try{var t=JSON.parse(n.responseText)}catch(o){o.msg="parse text to json error",e(o)}e(null,t)}},n.ontimeout=function(){e("timeout")},n.onerror=function(t){t.msg="network error not frontQnUper self error",e(t)},t.onProgress&&(n.upload.onprogress=function(t){o.progress(t.total,t.loaded)}),n.send("POST"===t.method?t.data:null)},a=function(t){if("[object Object]"!==Object.prototype.toString.call(t))throw new Error("options must be Object");t.imageType?this.imageTypeArr=t.imageType.split(","):this.imageTypeArr=o,this.domain=t.domain,this.url=t.tokenUrl,this.prefix=t.prefix||"font-qn-uper/",this.timeout=t.timeout||5e3,this.maxMobileWidth=t.maxWidth||480,this.maxPcWidth=t.maxPcWidth||960,this.defaultSize=parseInt(t.maxImgSize,10)||10240,this.uploadUrl="http://upload.qiniu.com/?token="};a.prototype.checkType=function(t){var e,o=this.file.name,n=this.file.size/1024,r=o.substring(o.lastIndexOf(".")+1).toLowerCase();-1===this.imageTypeArr.indexOf(r)?(e="图片格式为下面的一种:  "+this.imageTypeArr.toString(),t(e)):n>this.defaultSize?(e="图片大小因控制在"+this.defaultSize+" 内",t(e)):t()},a.prototype._getToken=function(t){var e={method:"GET",url:this.url};if("function"!=typeof t)throw new Error("when get uptoken the cb must be Function");i(e,t)},a.prototype._postPrepare=function(t){var o=this;this.checkType(function(n){return n&&"function"==typeof o.errHandle?o.errHandle(n):void o._getToken(function(n,r){return n&&"function"==typeof o.errHandle?o.errHandle(e):(o.token=r,void("function"==typeof t&&t()))})})},a.prototype.post=function(t,e){this.file=t;var o=this,r=n();this._postPrepare(function(){var n=new FormData;n.append("file",t),n.append("key",o.prefix+r);var a=o.uploadUrl+o.token.uptoken+"&rand="+Math.random(),p={method:"POST",url:a,onProgress:!0,data:n};i.call(o,p,function(t,n){if(t&&"function"==typeof errHandle)return errHandle(t);var r={};r.fullImageUrl=o.domain+"/"+n.key,r.mobileImageUrl=o.domain+"/"+n.key+"?imageView2/0/w/"+o.maxMobileWidth,r.pcImageUrl=o.domain+"/"+n.key+"?imageView2/2/w/"+o.maxPcWidth,e(r)})})},window.frontQnUper=a}();